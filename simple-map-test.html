<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>簡單地圖測試</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .controls {
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>簡單地圖測試</h1>
  <div class="status" id="status">載入中...</div>
  <div class="controls">
    <button onclick="loadTestRoute()">載入測試路線</button>
    <button onclick="loadD1Route()">載入 D1 路線</button>
    <button onclick="clearMap()">清除地圖</button>
  </div>
  <div id="map"></div>

  <script>
    let map = null;
    let currentMarkers = [];
    let currentPolylines = [];

    // 檢查庫是否載入
    window.addEventListener('load', function() {
      const statusDiv = document.getElementById('status');
      
      if (typeof L === 'undefined') {
        statusDiv.innerHTML = '❌ Leaflet 未載入';
        statusDiv.style.background = '#f8d7da';
        statusDiv.style.color = '#721c24';
        return;
      }
      
      statusDiv.innerHTML = '✅ Leaflet 載入成功';
      statusDiv.style.background = '#d4edda';
      statusDiv.style.color = '#155724';
      
      // 初始化地圖
      initMap();
    });

    function initMap() {
      map = L.map('map', {
        center: [23.5, 121],
        zoom: 8
      });
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(map);
      
      console.log('地圖初始化完成');
    }

    function clearMap() {
      // 清除所有標記和路線
      currentMarkers.forEach(marker => map.removeLayer(marker));
      currentPolylines.forEach(line => map.removeLayer(line));
      currentMarkers = [];
      currentPolylines = [];
    }

    function loadTestRoute() {
      clearMap();
      
      const points = [
        { lat: 24.3780, lon: 121.4500, name: '起點' },
        { lat: 24.3550, lon: 121.4420, name: '終點' }
      ];
      
      // 添加標記
      points.forEach(point => {
        const marker = L.marker([point.lat, point.lon])
          .bindPopup(point.name)
          .addTo(map);
        currentMarkers.push(marker);
      });
      
      // 添加路線
      const route = points.map(p => [p.lat, p.lon]);
      const polyline = L.polyline(route, { color: 'red', weight: 3 }).addTo(map);
      currentPolylines.push(polyline);
      
      // 縮放到路線範圍
      map.fitBounds(polyline.getBounds());
      
      console.log('測試路線載入完成');
    }

    function loadD1Route() {
      clearMap();
      
      const points = [
        { lat: 24.3780, lon: 121.4500, name: '勝光登山口' },
        { lat: 24.3745, lon: 121.4475, name: '大水池登山口' },
        { lat: 24.3720, lon: 121.4460, name: '710林道4.8K' },
        { lat: 24.3680, lon: 121.4450, name: '8.0K松風嶺' },
        { lat: 24.3635, lon: 121.4445, name: '木杆鞍部' },
        { lat: 24.3605, lon: 121.4435, name: '南湖溪山屋' },
        { lat: 24.3550, lon: 121.4420, name: '香菇寮營地' }
      ];
      
      // 添加標記
      points.forEach(point => {
        const marker = L.marker([point.lat, point.lon])
          .bindPopup(point.name)
          .addTo(map);
        currentMarkers.push(marker);
      });
      
      // 添加路線
      const route = points.map(p => [p.lat, p.lon]);
      const polyline = L.polyline(route, { color: 'blue', weight: 3 }).addTo(map);
      currentPolylines.push(polyline);
      
      // 縮放到路線範圍
      map.fitBounds(polyline.getBounds());
      
      console.log('D1 路線載入完成');
    }
  </script>
</body>
</html>
